/**
 * @file Firestore Security Rules for Smart Analytics Dashboard.
 *
 * Core Philosophy:
 * This ruleset enforces a strict admin-only access model. All data in all collections is considered sensitive and should only be accessible by authorized admin users.
 *
 * Data Structure:
 * The Firestore database is organized into top-level collections for districts, records, specialDrives, convictions, detections, and fileUploads.
 *
 * Key Security Decisions:
 * - Public data access is permitted for reads for prototyping.
 * - Listing of any collections is disallowed to prevent unauthorized data enumeration, except for prototyping.
 * - Write operations are restricted to admin users to ensure data integrity.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Checks if the user is an admin.
     * @return {boolean} True if the user is an admin, false otherwise.
     * @note This is a placeholder. Replace with your actual admin role check.
     */
    function isAdmin() {
      // For prototyping, we allow writes. 
      // TODO: Implement your admin role check here for production.
      // Example: return request.auth.token.email == 'admin@example.com';
      return true;
    }

    /**
     * @description Default rule for all collections.
     * @principle Allows reads for prototyping but restricts writes to admins.
     */
    match /{document=**} {
      allow read: if true;
      allow write: if isAdmin();
    }

    /**
     * @description Security rules for the /districts collection.
     * @path /districts/{districtId}
     */
    match /districts/{districtId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    /**
     * @description Security rules for the /records collection.
     * @path /records/{recordId}
     */
    match /records/{recordId} {
      allow read: if true;
      allow create: if isAdmin();
      allow update, delete: if false; // Records are immutable for now
    }

    /**
     * @description Security rules for the /specialDrives collection.
     * @path /specialDrives/{specialDriveId}
     */
    match /specialDrives/{specialDriveId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    /**
     * @description Security rules for the /convictions collection.
     * @path /convictions/{convictionId}
     */
    match /convictions/{convictionId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    /**
     * @description Security rules for the /detections collection.
     * @path /detections/{detectionId}
     */
    match /detections/{detectionId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    /**
     * @description Security rules for the /fileUploads collection.
     * @path /fileUploads/{fileUploadId}
     */
    match /fileUploads/{fileUploadId} {
      allow read: if true;
      allow write: if isAdmin();
    }
  }
}
